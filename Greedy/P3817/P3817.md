# 洛谷 P3817 题解总结

## 一、题目概述
[洛谷 P3817](https://www.luogu.com.cn/problem/P3817)

给定长度为 \(n\) 的糖果数组 \(a\) 与上限 \(x\)，要求对数组进行调整（只能减少元素值，不能增加），使得**任意相邻两个元素的和不超过 \(x\)**，求最少需要吃掉的糖果总数。

## 二、贪心策略思路
### 核心策略
从左往右依次遍历数组，**优先减少右侧元素**，保证左侧元素不被回溯修改。
- 遍历每一对相邻元素 \(a[i-1]\) 与 \(a[i]\)；
- 若两者之和超过 \(x\)，计算需要减少的糖果数 \(d = 总和 - x\)；
- 优先从右侧元素 \(a[i]\) 扣除，若右侧不够则再扣左侧 \(a[i-1]\)；
- 累加总减少量，即为答案。

### 策略合理性
左侧元素已完成与前一个元素的适配，修改左侧会无意义回溯，优先修改右侧可影响后续配对，保证每一步局部最优，最终达成全局最优。

## 三、策略正确性证明（交换论证法）
### 证明思路
任取一个最优解，可通过**逐步改造**将其变为贪心解，且改造过程中总代价（吃掉的糖果数）不增加，由此证明贪心解等价于最优解。

## 四、代码实现与问题修复
### 原代码问题
核心贪心逻辑正确，但存在**整数溢出**风险：
- 数组 \(a\) 定义为 `int`，两数相加易超出 `int` 范围；
- 临时变量 \(s、d\) 为 `int`，无法适配题目大数据范围。

## 五、总结
1. 本题最优解法为**贪心算法**，核心是「从左到右、优先减少右侧元素」；
2. 通过**交换论证法**可严谨证明该策略的正确性；
3. 代码实现需注意**数据类型溢出**，大数据场景优先使用 `long long`；
4. 算法时间复杂度 \(O(n)\)，空间复杂度 \(O(1)\)，完美适配题目数据规模。